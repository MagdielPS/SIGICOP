#{extends 'laySeg.html' /} 
#{set title:'Pagina Do Administrador' /}
<div id="corpoCelular" class="heightMin">
	<div class="text-center">
		<div class="h1 text-dark text-center tituloCelular">Lista de Pedidos em Espera</div>
	</div><br />
#{if listaPedidosPa.size() == 0}
<!-- informa se não houver ou não encontrar nenhum pedido-->
	<div class="text-center">
		<div class="h1 text-primary text-center tituloCelular">(Nenhum pedido encontrado)</div>
	</div>
#{/if} 
#{if listaPedidosPa != null}
	<div class="row">
  		<div class="col">
	    	<div class="collapse multi-collapse m-0 p-0" id="multiCollapseExample1">
		      	<div class="card card-body m-0 p-0">
#{if listaPedidosPa.size() > -1}
<!-- filtro por matricula do usuario e nome do arquivo-->
					<form action="@{Administradores.paginaAdmin}" method="post">
						<fieldset class="corFiltro shadow-lg rounded">
					        <legend>Filtrar Por:</legend>
							<div class="form-row">
						    	<div class="form-group col-md-6">
							    	<label for="matriculaDoUsuarioFiltro">Matricula do Usuário:</label>
									<input type="text" name="matriculaDoUsuarioFiltro" class="form-control" placeholder="Matricula do usuario" 
									id="matriculaDoUsuarioFiltro" maxlength="100" value="${matriculaDoUsuarioFiltro}">
						    	</div>
						    	<div class="form-group col-md-6">
							    	<label for="nomeDoArquivoFiltro">Nome do Arquivo:</label>
									<input type="text" name="nomeDoArquivoFiltro" class="form-control" placeholder="Nome do Arquivo" 
									id="nomeDoArquivoFiltro" maxlength="100" value="${nomeDoArquivoFiltro}">
						    	</div>
						  		</div>
						 		<div class="text-center"">
							  		<button type="submit" class="btn btn-primary icon">Filtrar <i class="filter icon"></i></button>
									<span class="btn btn-danger icon" id="limpar">Limpar <i class="eraser icon"></i></span>	 	
								</div>
						 	</fieldset>
						</form><br><br>
<!-- fim filtro -->
#{/if}
				</div>
	    	</div>
  		</div>
  	</div>	
	<div class="container">
 		<div class="row">
#{list items:listaPedidosPa, as:'p'}
 <!-- listar todos os pedidos com o status em "AGUARDANDO"-->
	   		<div class="col-lg-6">
				<div class="card text-white bg-dark mb-3" style="max-width: 100%;">
					<div class="card-header text-center pt-1 pb-1">
						<span class="soIcon">
							<div class="text-primary m-0 h6">Usuario:</div>
					${p.usuario.nomeUsu}<br />
						</span>
						<div class="text-primary m-0 h6">Matricula:</div>
				${p.usuario.matricula}
					</div>
					<div class="card-body pt-0 pb-1">
						<div class="card-text">
							<b>Cópias: </b> ${p.qtdCopias}
						</div>
						<div class="card-text">
							<b>Face: </b> ${p.frenteVerso}
						</div>
						<div class="card-text">
							<b>Status: </b>
							<div class=" text-center roundedc statusAguardando"> ${p.status}</div>
						</div>
						<button class="btn btn-outline-info mt-1 m-0 mb-1 btn-sm btn-block" data-toggle="collapse" href="#collapseExample${p.id}" 
						 	role="button" aria-expanded="false" aria-controls="collapseExample"><i class="plus icon"></i><span class="soIcon">Informacoes</span>
					  	</button>
						<div class="collapse text-left" id="collapseExample${p.id}">
						  	<div class="card bg-dark">
								<div class="card-text">
									<b>Data de Envio: </b> ${p.dataEnvio}
								</div>
								<div class="card-text">
									<b>Arquivo: </b> ${p.nomeArquivo}
								</div>
#{if p.descricao} 
								<div class="card-text">
									<b>Descricao: </b> ${p.descricao} 
#{if p.descricao = ""}[sem descricao] #{/if}<br />
								</div>
#{/if}
							</div>
						</div>
						<div class="card-text text-center">
							<div class="sticky-top">
								<a class="btn btn-primary m-1 icon" href="@{Administradores.download(p.id)}" style="font-size: auto; 
								text-decoration: none; font-size: 85%; color: white; margin: 0px;">
								<span class="soIcon">Download</span>
								<i style="float: right; margin: 1px;" class="download icon"></i>
								</a>
								<a class="btn btn-success m-1 icon concluir" data-item="${p.id}" href="#" style="font-size: auto; text-decoration: none; 
								font-size: 85%; color: white; margin: 0px;" >
								<span class="soIcon">Concluir</span>
								<i style="float: right; margin: 1px;" class="check icon"></i>
								</a>
								<a class="btn btn-danger m-1 icon recusar" data-item="${p.id}" href="#" style="font-size: auto; text-decoration: none;
								font-size: 85%; color: white; margin: 0px;">
								<span class="soIcon">Recusar</span>
								<i style="float: right; margin: 1px;" class="x icon"></i>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
#{/list}
		</div>
	</div>
#{/if}
</div>
<form id="con" action="@{Pedidos.concluido}">
	<input type="hidden" id="idPedCon" name="idPedCon" />
	<input type="hidden" id="resposta" name="resposta" />
</form>
<form id="recusa" action="@{Pedidos.recusar}">
	<input type="hidden" id="idPed" name="idPed" />
	<input type="hidden" id="motivo" name="motivo" />
</form> 
<script type="text/javascript">

	$(document).ready(function () {
	    setTimeout(function () {
	        window.location.reload(1);
	    }, 180000); //tempo em milisegundos. Neste caso, o refresh vai acontecer de 5 em 5 segundos.
	});
</script>
<script type="text/javascript">
$(document).ready(function(){
	$(".recusar").click(function() {
		var idPedido = $(this).data("item");
		
		Swal.fire({
			  title: 'Motivo da recusa:',
			  input: 'text',
			  inputPlaceholder: 'descreva o motivo do pedido ser recusado',
			  inputAttributes: {
			    'aria-label': 'Type your message here'
			  },
			  showCloseButton: true,
			  showCancelButton: true,
			  showClass: {
				    popup: 'animated fadeInDown faster'
				  },
			  hideClass: {
				    popup: 'animated fadeOutUp faster'
				  }
		}).then((result) => {
			if(result.value == ""){
				Swal.fire({
					  icon: 'error',
					  title: 'ERROR...',
					  text: 'preencha o motivo!',
					  showCloseButton: true,
					  showClass: {
						    popup: 'animated pulse faster'
						  },
					  hideClass: {
						  popup: 'animated fadeOutUp faster'
					  }
					})
								}
			if (result.value) {
				$('#idPed').val(idPedido);
				$('#motivo').val(result.value);
				$('#recusa').submit();
			}
		})
	});

	$(".concluir").click(function() {
		var idPedido = $(this).data("item");
		
		Swal.fire({
			  title: 'Mensagem de conclusão:',
			  input: 'text',
			  inputPlaceholder: 'digite alguma mensagem complementar',
			  inputAttributes: {
			    'aria-label': 'Type your message here'
			  },
			  showCloseButton: true,
			  showCancelButton: true,
			  showClass: {
				    popup: 'animated fadeInDown faster'
				  },
			  hideClass: {
				    popup: 'animated fadeOutUp faster'
				  }
		}).then((result) => {
			if(result.value == ""){
				result.value = ".";
				}
			if (result.value) {
				$('#idPedCon').val(idPedido);
				$('#resposta').val(result.value);
				$('#con').submit();
			}
		})
	});
});
</script>
