#{extends 'laySeg.html' /} 
#{set title:'Tela Do Administrador' /}
<div id="corpoCelular" class="heightMin">
	<div class="text-center">
	<div class="h1 text-dark text-center">Lista de Pedidos em Espera</div>
	</div>
		<br />
#{if listaPedidos.size() == 0}
		<div class="text-center">
		<div class="h1 text-primary text-center">(Nenhum pedido em Espera)</div>
		</div>
#{/if} 
#{if listaPedidos != null}
#{if listaPedidos.size() > -1}
		<div class="text-center">
		<div class="h1 text-dark text-center">Filtrar Por:</div><br>
		</div>
<div class="corFiltro shadow-lg rounded">
	<form action="@{Administradores.paginaAdmin}" method="post">
		<div class="form-row">
    	<div class="form-group col-md-6">
    	<label for="NomeUser">Nome do Usuário:</label>
		<input type="text" name="NomeDoUsuarioFiltro" class="form-control" placeholder="Nome do usuario" id="NomeUser" maxlength="100" >
    	</div>
    	<div class="form-group col-md-6">
    	<label for="matricula">Matricula do Usuário:</label>
		<input type="text" name="matriculaDoUserFiltro" class="form-control" placeholder="Matricula do usuario" id="matricula" maxlength="100" >
    	</div>
   		<div class="form-group col-md-6">
    	<label for="NomeDoArquivoFiltro">Nome do Arquivo:</label>
		<input type="text" name="NomeDoArquivoFiltro" class="form-control" placeholder="Nome do Arquivo" id="NomeDoArquivoFiltro" maxlength="100">
    	</div>
      	<div class="form-group col-md-6">
      	<label for="descricaoFiltro">Descricao:</label>
      	<textarea  name="descricaoFiltro"  class="form-control" id="descricaoFiltro" rows="2" maxlength="100" placeholder="Descricao"></textarea>
    	</div>
  		</div>
 		<div class="text-center"">
  		<button type="submit" class="btn btn-primary icon">Filtrar <i class="filter icon"></i></button>
	 	</div>
	</form>
</div><br><br>
#{/if}
	
		<div class="container">
 		<div class="row">
#{list items:listaPedidos, as:'p'}
   		<div class="col-lg-4">
		<div class="card text-white bg-dark mb-3" style="max-width: 100%;">
		<div class="card-header text-center">
		<h6 class="text-primary">Usuario:</h6>
${p.usuario.nomeUsu}<br />
		<h6 class="text-primary">Matricula:</h6>
${p.usuario.matricula}
		</div>
		<div class="card-body">
		<div class="card-text">
		<b>Arquivo: </b> ${p.nomeArquivo}
		</div>
		<div class="card-text">
		<b>Quantidade de Copias: </b> ${p.qtdCopias}
		</div>
		<div class="card-text">
		<b>Frente ou verso : </b> ${p.frenteVerso}
		</div>
		<div class="card-text">
#{if p.descricao} <b>Descricao: </b> ${p.descricao} #{if p.descricao = ""}[sem descricao] #{/if}<br />
#{/if}
		</div>
		<div class="card-text">
		<b>Status: </b>
		<div class="bg-warning text-dark text-center rounded"> ${p.status}</div>
		</div>
		<div class="card-text">
		<b>Data de Envio: </b> ${p.dataEnvio}
		</div>
		<div class="card-text text-center">
		<a href="@{Administradores.download(p.id)}" class="btn btn-primary m-1 icon">Fazer Download<i style="float: right; margin: 1px;" class="download icon"></i></a>
		<span class="sticky-top">
		<a class="concluir" data-item="${p.id}" href="#" style="font-size: medium; text-decoration: none; color: white; margin: 0px;" ><span class="btn btn-success mt-1 mb-1 icon" >Concluir <i style="float: right; margin: 1px;" class="check icon"></i></span></a>
		<a class="recusar" data-item="${p.id}" href="#" style="font-size: medium; text-decoration: none; color: white; margin: 0px;"><span class="btn btn-danger mt-1 mb-1 icon" >Recusar<i style="float: right; margin: 1px;" class="x icon"></i></span> </a>
		<!-- onMouseOver="this.style='color: black; font-size: medium; text-decoration: none; color: white;'" 
		onMouseOut="this.style='color: color: white; font-size: medium; text-decoration: none; color: white;'" -->
		</span>
		</div>
		</div>
		</div>
 		</div>
#{/list}
		</div>
		</div>
#{/if}
</div>
<form id="con" action="@{Administradores.concluido}">
	<input type="hidden" id="idPedCon" name="idPedCon" />
	<input type="hidden" id="resposta" name="resposta" />
</form>
<form id="recusa" action="@{Administradores.recusar}">
	<input type="hidden" id="idPed" name="idPed" />
	<input type="hidden" id="motivo" name="motivo" />
</form>
<form id="formRestaurar" action="@{Administradores.restaurarQtd}">
</form>
<script type="text/javascript">
	$(document).ready(function () {
	    setTimeout(function () {
	        window.location.reload(1);
	    }, 180000); //tempo em milisegundos. Neste caso, o refresh vai acontecer de 5 em 5 segundos.
	});
	
	
</script>
<script type="text/javascript">
	$(".recusar").click(function() {
		var idPedido = $(this).data("item");
		
		Swal.fire({
			  title: 'Motivo da recusa:',
			  input: 'textarea',
			  inputPlaceholder: 'descreva o motivo do pedido ser recusado',
			  inputAttributes: {
			    'aria-label': 'Type your message here'
			  },
			  showCloseButton: true,
			  showCancelButton: true
		}).then((result) => {
			if(result.value == ""){
				Swal.fire({
					  icon: 'error',
					  title: 'ERROR...',
					  text: 'preencha o motivo!',
					  footer: '<a href>Limpar e tentar novamente</a>',
					  showCloseButton: true
					})
								}
			if (result.value) {
				$('#idPed').val(idPedido);
				$('#motivo').val(result.value);
				$('#recusa').submit();
			}
		})
	});
</script>
<script type="text/javascript">
	$(".concluir").click(function() {
		var idPedido = $(this).data("item");
		
		Swal.fire({
			  title: 'Mensagem de conclus�o:',
			  input: 'textarea',
			  inputPlaceholder: 'digite alguma mensagem complementar',
			  inputAttributes: {
			    'aria-label': 'Type your message here'
			  },
			  showCloseButton: true,
			  showCancelButton: true
		}).then((result) => {
			if(result.value == ""){
				result.value = ".";
				}
			if (result.value) {
				$('#idPedCon').val(idPedido);
				$('#resposta').val(result.value);
				$('#con').submit();
			}
		})
	});
</script>
