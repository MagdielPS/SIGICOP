#{extends 'laySeg.html' /} 
#{set title:'Pagina do Usuario' /}
<div id="corpoCelular" class="heightMin">
    <div class="collapse multi-collapse m-0 mr-1-celular ml-1-celular animated zoomIn faster" id="multiCollapseExample1">
#{if listaPedidos.size() > -1}
<!-- Filtro por nome do arquivo e descrição -->
			<form action="@{Usuarios.filtro}" method="post" class="font-size-celular shadow-lg rounded corFiltro m-0-celular pt-1-celular">
				<fieldset class="mb-0-celular">
			        <legend class="mb-0">Filtrar Por:</legend>
					<div class="form-row m-0">
				   		<div class="form-group col-md-12 mt-1-celular mb-0-celular">
					    	<label for="NomeDoArquivoFiltro" class="m-0-celular">Nome do Arquivo:</label>
							<input type="text" name="NomeDoArquivoFiltro" class="form-control hei-input-celular font-size-celular" 
							placeholder="Nome do Arquivo"
							id="NomeDoArquivoFiltro" value="${NomeDoArquivoFiltro}">
				    	</div>
				      	<div class="form-group col-md-6 mt-1-celular mb-0-celular">
					      	<label for="descricaoFiltro" class="m-0-celular">Descrição:</label>
					      	<input  name="descricaoFiltro"  class="form-control hei-input-celular font-size-celular" 
					      	id="descricaoFiltro"  placeholder="Descricao" 
					      	value="${descricaoFiltro}" />
				      	</div>
				      	<div class="form-group col-md-6 mt-1-celular mb-0-celular">
					      	<label for="statusFiltro" class="m-0-celular">Status:</label>
					      	<select name="statusFiltro" id="statusFiltro" class="form-control hei-input-celular font-size-celular">
					      		<option value="TODOS" #{if statusFiltro.equals("TODOS")}selected #{/if} class="m-0-celular p-0-celular">--TODOS--</option>
					      		<option value="AGUARDANDO" #{if statusFiltro.equals("AGUARDANDO")}selected #{/if} class="m-0-celular p-0-celular">AGUARDANDO</option>
					      		<option value="ENTREGUE" #{if statusFiltro.equals("ENTREGUE")}selected #{/if} class="m-0-celular p-0-celular">ENTREGUE</option>
					      		<option value="CONCLUIDO" #{if statusFiltro.equals("CONCLUIDO")}selected #{/if} class="m-0-celular p-0-celular">CONCLUIDO</option>
					      		<option value="RECUSADO" #{if statusFiltro.equals("RECUSADO")}selected #{/if} class="m-0-celular p-0-celular">RECUSADO</option>
					      	</select>
				      	</div>
			  		</div>
			 		<div class="text-center mt-1-celular">
				  		<button type="submit" class="btn btn-primary butaoIconTexto font-size-celular">Filtrar <i class="filter icon"></i></button>
						<span class="btn btn-danger butaoIconTexto font-size-celular" id="limpar">Limpar <i class="eraser icon"></i></span>
				  		<a href="@{Pedidos.solicitar}" class="btn btn-success mb-1-celular mt-1-celular butaoIconTexto font-size-celular block-celular">Solicitar
				  		<i class="file alternate outline icon"></i></a>
				 	</div>
				</fieldset>
			</form><br>
<!-- fim Filtro -->
#{/if}
	</div>

#{if listaPedidos.size() == 0 }
<!-- informa se n�o houver ou n�o encontrar nenhum pedido-->
	<div class="text-center">
		<div class="h1 text-primary font-size-celular shadow p-2 m-2">Nenhum pedido foi encontrado</div>
	</div>
	<div class="h1 font-size-celular text-center mt-5 mt-1-celular">
	<a href="@{pedidos.solicitar}" class="btn btn-primary m-0 mt-1 mb-1
							btn-sm butaoIconTexto font-size-celular shadow p-3 pl-5 pr-5 m-2 mt-5 rounded">Solicitar</a>
	</div>
#{/if} 
#{else}
	<div class="container font-size-celular">
 		<div class="row">
#{list items:listaPedidos, as:'p'}
<!-- listar todos os pedidos anteriores (se houver) -->
	   		<div class="col-lg-6">
				<div class="card text-white bg-dark mb-3 shadow-lg m-0" style="max-width: 100%;">
					<div class="card-header text-center pt-1 pb-1">
						<h5 class="text-primary m-0">Pedido:</h5>
					</div>
					<div class="card-body pt-0 pb-0">
						<div class="card-tex">
							<b>Nome: </b> <span id="maxNome">${p.nomeArquivo}</span>
						</div>
						<div class="card-text">
							<b>Cópias: </b> ${p.qtdCopias}
						</div>

						<b>Status: </b>
#{if p.status.name() == 'RECUSADO'}
						<div class="text-center rounded statusRecusado" id="statusPedido">
							${p.status}
						</div>	
#{/if}
#{if p.status.name() == 'AGUARDANDO'}
						<div class=" text-center rounded statusAguardando" id="statusPedido">
							${p.status}
						</div>	
#{/if}
#{if p.status.name() == 'CONCLUIDO'}
						<div class=" text-center rounded statusConcluido" id="statusPedido">
							${p.status}
						</div>	
#{/if}
#{if p.status.name() == 'ENTREGUE'}
						<div class=" text-center rounded statusEntregue" id="statusPedido">
							${p.status}
						</div>
#{/if}
						<div class="text-center mt-1">
					  		<button class="btn btn-outline-info btn-sm btn-block font-size-celular" data-toggle="collapse" href="#collapseExample${p.id}" 
					  		role="button" aria-expanded="false" aria-controls="collapseExample">
					    	+ Informações
					  		</button>
						</div>
						<div class="collapse text-left" id="collapseExample${p.id}">
							<div class="card bg-dark m-0">
								<div class="card-text">
									<b>Face: </b> ${p.frenteVerso}
								</div>
								<div class="card-text">
#{if p.descricao}
									<b>Descrição: </b> ${p.descricao}<br />
#{/if}
								</div>
								<div class="card-text">
									<b>Data de Envio: </b> ${p.dataEnvio}
								</div>
						  		<div class="card-text">
#{if p?.atendimento}
									<b>Atendimento: </b> ${p.atendimento}<br /> 
#{/if}
								</div>
								<div class="card-text">
#{if p?.dataAtendimento}
									<b>Data de atendimento: </b> ${p.dataAtendimento}<br /> 
#{/if}
								</div>
								<div class="card-text">
#{if p?.dataEntrega}
								<b>Data de Entrega: </b> ${p.dataEntrega}<br /> 
#{/if}
								</div>
							</div>
						</div>
#{if p.status.name() == 'AGUARDANDO'}
						
						<div class="card-text text-center ">
							<a href="@{Pedidos.apagarPedidoAguardando(p.id)}" class="btn btn-danger m-0 mt-1 mb-1
							btn-sm butaoIconTexto font-size-celular" >Apagar
							<i style="margin: 1px;" class="trash alternate outline icon"></i></a>
							<a href="@{Usuarios.download(p.id)}" class="btn btn-primary m-0 mt-1 mb-1
							btn-sm butaoIconTexto font-size-celular ">Baixar Arquivo
							<i style="margin: 1px;" class="download icon"></i></a>
						</div>
#{/if}
#{else}
						<div class="card-text text-center">
#{if !p.status.name() == 'ENTREGUE'}
							<a href="@{Usuarios.download(p.id)}" class="btn btn-primary m-0 mt-1 mb-1
							btn-sm btn-block butaoIconTexto font-size-celular">Baixar Arquivo
							<i style="margin: 1px;" class="download icon"></i></a>
#{/if}
#{if p.status.name() == 'ENTREGUE'}
							<a href="@{Pedidos.downloadRelatório(p.id)}" class="btn btn-secondary m-0 mt-1 mb-1
							btn-sm btn-block butaoIconTexto font-size-celular">Baixar Relatório
							<i style="margin: 1px;" class="download icon"></i></a>
#{/if}
						</div>
#{/else}
					</div>
				</div>
 			</div>
#{/list}
		</div>
	</div>
#{if }
#{/if}
#{/else}
</div>
<script type="text/javascript">
$(document).ready(function(e) {
/* var nome = document.getElementById('maxNome');
var maxNome = nome.substring(0, 5); //.indexOf(".")
	var ext = nome.split('.').pop();
	if(nome.length > 5){
	maxNome = maxNome+"[...]."+ext;  			
	}
	nome.innerHTML = maxNome; */
});
</script> 