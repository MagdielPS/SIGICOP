#{extends 'laySeg.html' /}
#{set title:'Solicitacao de Pedido(s)' /}
<div id="corpoCelular">	
#{if usuarioBanco?.qtdDisponivel == 0}
	<div class="py-5 text-center mb-3" style="background:#ff4a4a;">
        <h2>Atenção!</h2>
        <p class="lead">Você atingiu seu limite máximo de solicitacões nesse mês,
	    	 mas para isso, lembresse de salvar os pedidos.</p>
     </div>
#{/if}
#{else}	
<div class="row">
        <div class="col-md-6 order-md-1">
<!-- FORMULARIO DE PEDIDOS -->

<!-- FIM FORMULARIO DE PEDIDOS-->

          <h4 class="mb-3"><span class="text-muted">Solicitação:</span></h4>
          <form id="form-pedido" action="@{Pedidos.addPedido}" method="post" enctype="multipart/form-data" class="needs-validation" novalidate="">
                     <div class="mb-3">
          				<input type="hidden" name="name" id="arquivo"><!-- SALVAR O NOME DO ARQUIVO -->
          		<div class="float-left mt-2">
					<div class="float-left "><label for="item-arquivo" class="btn btn-primary icon" >Selecione o Arquivo
					<i class="paperclip icon"></i></label></div>
				</div>
				<div class="float-left ml-2">
					<span id="nomeArquivo" class="text-primary h4 text-center text-break"></span>
				</div><!-- accept=".pdf" -->
				<input type="file" name="item.arquivo"  style="display:none;" class="form-control" id="item-arquivo" >
				<br><br><br>
				</div>
            <div class="row">
              <div class="col-md-6">
 				<label>Cópias:<sup style="color: red;">*</sup></label>
 				<input type="number" name="item.qtdCopias" class="form-control" max="${usuarioBanco?.qtdDisponivel}" 
						min="1" class="qtdCopias" value="${valor}" id="qtdCopias">
                <div class="invalid-feedback">
                  É obrigatório inserir um nome válido.
                </div>
              </div>
              <div class="col-md-6">
				<label>Frente e Verso:<sup style="color: red;">*</sup></label><br>
				<div class="custom-control custom-radio custom-control-inline">
					  		<input type="radio" id="frente" name="item.frenteVerso" class="custom-control-input" 
					  		value="frente" checked="checked">
					 		<label class="custom-control-label text-justify" for="frente">Frente</label>
						</div>
						<div class="custom-control custom-radio custom-control-inline">
					 		<input type="radio" id="frenteEverso" name="item.frenteVerso" class="custom-control-input" 
					 		value="frenteEverso">
					  		<label class="custom-control-label text-justify" for="frenteEverso">Frente e Verso</label>
					  		<sub style="color: red; padding: 0; margin: 0;">2x</sup>
						</div>
                <div class="invalid-feedback">
                  É obrigatório inserir um sobre nome válido.
                </div>
              </div>
            </div>

            <div class="mb-3">
			<label>Descricao</label>
              <div class="input-group">
                <textarea rows="3" cols="7" name="item.descricao" class="form-control" placeholder="descrição"></textarea>
                <div class="invalid-feedback" style="width: 100%;">
                  Seu nickname é obrigatório.
                </div>
              </div>
            </div>
            <button class="btn btn-success btn-lg btn-block" type="submit" id="add">Adicionar<i class="paper plane outline icon"></i></button>
            <hr class="mb-4">
          </form>
        </div>
#{/else}
 <div class="col-md-6 order-md-2">
			<h4 class="d-flex justify-content-between align-items-center mb-3">
				<span class="text-muted m-0">Listagem de Pedidos</span>
#{if listaDePedidos != null}
               	 <a href="@{Pedidos.salvar}" class="btn btn-primary m-0">Salvar
					<span class="badge badge-secondary badge-pill float-right">${listaDePedidos?.size()}</span>
		 		</a>
#{/if}
				
			</h4>
		<!-- 	<div class="card p-2">
            <div class="input-group text-center">

            </div>
          </div> -->
         <!--  <ul class="list-group mb-3">
            <li class="list-group-item d-flex justify-content-between lh-condensed"> -->
              	<div class="listaPped m-0 p-0">
#{if listaDePedidos == null}
<!-- informa se n�o houver nenhum pedido adicionado-->
		<div class="h1 text-primary" style="font-size: 120%;">Nenhum pedido adicionado</div>
#{/if}
#{else}
<!-- listar todos os pedidos adicionados(se houver)-->
		<div class="container">
		<div class="row">
#{list items: listaDePedidos, as: 'p'}
				<div class="col-lg-6 m-0 p-0 borderColorCorpo">
					<div class="card text-white bg-dark mb-2 pt-0 pb-1 text-center" style="max-width: 100%;">
						<div class="card-header m-0 p-0">
#{if listaDePedidos.size() > 1}Meus Pedidos #{/if} 
#{else} Meu pedido #{/else}
						</div>
						<div class="card-body text-left m-0 pt-0 pb-0">
							<div class="card-text mt-0">
								<b>Cópias: </b> ${p.qtdCopias}
							</div>
							<div class="card-text">
								<b>Frente ou verso : </b> ${p.frenteVerso}
							</div>
							<div class="mt-1">
					  		<button class="btn btn-outline-info m-0 mb-1" data-toggle="collapse" href="#collapseExample${p.idLista}" 
					  		role="button" aria-expanded="false" aria-controls="collapseExample"><i class="plus icon"></i><span class="soIcon">Informacoes</span>
				  			</button>
				  			<div class="collapse text-left" id="collapseExample${p.idLista}">
				  			<div class="card bg-dark">
					  			<div class="card-text">
									<b>Arquivo: </b> ${p.nomeArquivo}
								</div>
								<div class="card-text">
#{if p?.descricao}
									<b>Descricao: </b> ${p.descricao}<br /> 
#{/if}
								</div>
								<div class="card-text">
									<b>Status: </b> ${p.status}
								</div>
				  			</div>
				  			</div>
							</div>
							<div class="card-text text-center">
								<a href="@{Pedidos.cancelarPedido(p.id)}" class="btn btn-danger icon mt-1">Cancelar <i class="trash alternate outline icon"></i></a>
							</div>
						</div>
						</div>
					</div>
#{/list}
				</div>
#{/else}
	</div>
	</div>

          <!--   </li>
          </ul> -->
        </div>
      </div>
</div>
<!-- JS DA PAGINA -->
<script type="text/javascript">
$(document).ready(function(e) {
// informa que � obrigat�rio o anexo do arquivo
	$("#form-pedido").submit(function(e) {
		var arq = $("#item-arquivo").val();
		if (arq == "") {
			/*alert("Você deve anexar um arquivo!");*/
			e.preventDefault();
			Swal.fire({
				icon: 'error',
				title: 'ERROR...',
				text: 'é obrigatório o anexo do arquivo!',
				showCloseButton: true,
				showClass: {
				    popup: 'animated fadeInDown faster'
				},
				hideClass: {
					popup: 'animated fadeOutUp faster'
				}  
			})
		}else{
			var podeAdd = $("#qtdCopias").val();
			console.log("qtdCopias :"+podeAdd);
			if(podeAdd > 0){
				const Toast = Swal.mixin({
					toast: true,
				  	position: 'top',
				  	showConfirmButton: false,
				  	timer: 3000,
			  		timerProgressBar: true,
				  	onOpen: (toast) => {
				    	toast.addEventListener('mouseenter', Swal.stopTimer)
				    	toast.addEventListener('mouseleave', Swal.resumeTimer)
				  	}
				})
				Toast.fire({
				  icon: 'info',
				  title: 'Pedido listado'
				})
				setTimeout(function(){ 
					e.submit();
				}, 3000);
			}
		}			
	})
// pega o nome do arquivo e jogar para o campo hidden nomeArquivo
    var inputNome = document.getElementById('nomeArquivo');
	var inputFicheiro = document.getElementById('item-arquivo');

	inputFicheiro.addEventListener('change', function() {
  		var nome = this.files[0].name;
  		inputNome.innerHTML = nome;
  		document.getElementById('arquivo').value = nome;
	})
});
</script>
<script type="text/javascript"> 
</script>
