#{extends 'laySeg.html' /} 
#{set title:'Pedidos Concluidos' /}
<div class="heightMin">	
#{if listaconcluidos != null}
	    	<div class="collapse multi-collapse m-0 mr-1-celular ml-1-celular animated zoomIn faster" id="multiCollapseExample1">
#{if listaconcluidos.size() > -1}
<!-- Filtro por nome do usuario e nome do arquivo -->
					<form action="@{Pedidos.listarConcluidos}" method="post" class="brancoGelo font-size-celular shadow-sm rounded border m-0-celular pt-1-celular">
						<fieldset class="mb-0-celular">
					        <legend class="m-0-celular mb-0">Filtrar Por:</legend>
							<div class="form-row m-0">
						       	<div class="form-group col-md-6 mt-1-celular mb-0-celular">
							    	<label for="matriculaDoUsuarioFiltro">Matricula do Usuário:</label>
									<input type="text" name="matriculaDoUsuarioFiltro" class="form-control hei-input-celular font-size-celular" 
									placeholder="Matricula do usuario" id="matriculaDoUsuarioFiltro" maxlength="100" value="${matriculaDoUsuarioFiltro}">
						    	</div>
						   		<div class="form-group col-md-6 mt-1-celular mb-0-celular">
							    	<label for="nomeDoArquivoFiltro">Nome do Arquivo:</label>
									<input type="text" name="nomeDoArquivoFiltro" class="form-control hei-input-celular font-size-celular" 
									placeholder="Nome do Arquivo" id="nomeDoArquivoFiltro" maxlength="100" value="${nomeDoArquivoFiltro}">
						    	</div>
					  		</div>
					 		<div class="text-center mt-1-celular">
						  		<button type="submit" class="btn btn-primary butaoIconTexto font-size-celular">Filtrar <i class="filter icon"></i></button>
						  		<span class="btn btn-danger butaoIconTexto font-size-celular" id="limpar">Limpar <i class="eraser icon"></i></span>
						 	</div>
					 	</fieldset>
					</form><br>
<!-- Fim Filtro -->
#{/if}
  	</div>
	<div class="container font-size-celular">
 		<div class="row">
#{list items:listaconcluidos, as:'pc'}
<!-- listar todos os pedidos concluidos (se houver) -->
	   		<div class="col-lg-4">
				<div class="card mb-3 shadow-sm" style="max-width: 100%;">
					<div class="card-header text-center pt-1 pb-1">
						<h6 class="text-primary m-0">Matricula:</h6>
				${pc.usuario.matricula}
					</div>
					<div class="card-body brancoGelo pt-0 pb-1">
						<div class="card-text">
							<b>Arquivo: </b> <span id="${pc.id}"><!-- ${pc.nomeArquivo} --></span>
						</div>
						<div class="card-text">
							<b>Status: </b>
							<div class="statusConcluido text-white text-center rounded">${pc.status}</div> 
						</div>
						<div class="mt-1">
					  		<button class="btn btn-outline-info m-0 mb-1 btn-sm btn-block font-size-celular" data-toggle="collapse" href="#collapseExample${pc.id}" 
					  		role="button" aria-expanded="false" aria-controls="collapseExample"><i class="plus icon"></i><span class="desaparecer-celular">Informações</span>
				  			</button>
						</div>
						<div class="collapse text-left" id="collapseExample${pc.id}">
					  		<div class="card">
								<div class="card-text">
									<b>Cópias: </b> ${pc.qtdCopias}
								</div>
								<div class="card-text">
									<b>Face: </b> ${pc.frenteVerso}
								</div>
								<div class="card-text"> 
									<b>Descricao: </b> ${pc.descricao} 
#{if pc.descricao == null}(sem descricao) #{/if}<br />
								</div>
								<div class="card-text">
									<b>Data de Envio: </b><br> ${pc.dataEnvio}
								</div>
								<div class="card-text">
									<b>Data de Atendimento: </b><br>${pc.dataAtendimento}
								</div>
							</div>
						</div>
						<div class="card-text text-center">
							<div class="">
								<a class="recusar font-size-celular" data-item="${pc.id}" href="#Recusar" style="font-size: medium; text-decoration: none; color: white;">
									<span class="btn btn-outline-danger mt-1 mb-1 butaoIconTexto font-size-celular" ><span class="desaparecer-celular">Recusar</span>
									<i style="float: right; margin: 1px;" class="x icon"></i></span>
								</a>
								<a class="btn btn-outline-secondary m-1 butaoIconTexto entregar font-size-celular" data-item="${pc.id}" id="${pc.id}" href="#Entregar" >
									<span class="desaparecer-celular">Entregar</span>
									<i style="float: right; margin: 1px;" class="file alternate outline icon"></i>
								</a>
								<a href="@{Pedidos.downloadAdmin(pc.id)}" class="btn-sm-computador btn-block-computador btn btn-outline-primary m-1 butaoIconTexto font-size-celular">
									<span class="desaparecer-celular">Download</span>
									<i style="margin: 1px;" class="download icon"></i>
								</a>
							</div>
						</div>
					</div>
				</div>
	 		</div>
#{/list}
		</div>
	</div>		
#{/if}
#{if listaconcluidos.size() == 0}
<!-- informa se n�o houver ou n�o encontrar nenhum pedido-->
	<div class="text-center text-primary font-size-celular border" style="margin: 5% 20% 5% 20%; padding: 10%;">
			<img alt="Listagem Vazia" title="Vazio" src="@{'/public/images/icones/listagemVazia.png'}"/>
		<span class="desaparecer-celular">
			<div class="h1">Nenhum pedido foi encontrado</div>
		</span>
			<a data-toggle="collapse" href="#multiCollapseExample1" role="button" 
			aria-expanded="false" aria-controls="multiCollapseExample1" class="btn btn-primary m-0 mt-1
		btn-sm butaoIconTexto font-size-celular shadow-sm p-3 pl-5 pr-5 p-2-celular rounded">Tentar Filtrar
			</a>
	</div>
#{/if} 
</div>
<form id="recusa" action="@{Pedidos.concluidoParaRecusar}">
	<input type="hidden" id="idPed" name="idPed" />
	<input type="hidden" id="motivo" name="motivo" />
</form>
<script type="text/javascript">
$(document).ready(function () {
	    setTimeout(function () {
	        window.location.reload(1);
	    }, 180000); //tempo em milisegundos. Neste caso, o refresh vai acontecer de 5 em 5 segundos.
// DIALOG QUE ENTREGA PEDIDO	    
	$(".entregar").click(function() {
		var id = $(this).data("item");
		console.log("o valor do id de entregue :  "+id);
		$('#idEnt').val(id);
		Swal.fire({
			  html: '<div class="font-size-celular">Tem certeza que deseja entregar esse pedido?</div>'
					  +'<div class="bg-info text-white p-1 font-size-celular">Usuário do pedido: ${pc?.usuario?.matricula}</div>'
					  +'<br/><form action="@{Pedidos.entregarPedido}" method="post">'
			  		   +'<input type="hidden" id="idEnt" name="id" value="'+id+'"/>'
				  	   +'<input type="submit" value="Entregar" class="btn btn-primary m-1 butaoIconTexto font-size-celular" />'
				  	   +'</form>',
			  icon: 'question',
			  showCloseButton: true,
			  showCancelButton: false,
			  showConfirmButton: false,
			  showClass: {
				    popup: 'animated fadeInDown faster'
				  },
			  hideClass: {
				    popup: 'animated fadeOutUp faster'
				  }
		})
	}); 
// DIALOG QUE RECUSA PEDIDO
	$(".recusar").click(function() {
		var idPedido = $(this).data("item");
		
		Swal.fire({
			  title: 'Motivo da recusa:',
			  input: 'text',
			  inputPlaceholder: 'descreva o motivo do pedido ser recusado',
			  inputAttributes: {
			    'aria-label': 'Type your message here'
			  },
			  showCloseButton: true,
			  showCancelButton: true,
			  showClass: {
				    popup: 'animated fadeInDown faster'
				  },
			  hideClass: {
				    popup: 'animated fadeOutUp faster'
				  }
		}).then((result) => {
			if(result.value == ""){
				Swal.fire({
					  icon: 'error',
					  title: 'ERROR...',
					  text: 'preencha o motivo!',
					  showCloseButton: true,
					  showClass: {
						    popup: 'animated pulse faster'
						  },
					  hideClass: {
						    popup: 'animated fadeOutUp faster'
						  }
					})
								}
			if (result.value) {
				$('#idPed').val(idPedido);
				$('#motivo').val(result.value);
				$('#recusa').submit();
			}
		})
	});
});	
</script>
<script type="text/javascript">
$(document).ready(function(e) {
#{list items:listaconcluidos, as:'pc'}
	if(${pc.nomeArquivo.size()} > 20){
		var nomeCompletoArquivo = '${pc.nomeArquivo}';
		var nomeArquivoComplimido = '';
		for(var i = 0; i < 14; i++){
			nomeArquivoComplimido = nomeArquivoComplimido + nomeCompletoArquivo[i];
		}
		document.getElementById('${pc.id}').innerHTML = nomeArquivoComplimido+'[...]';
	}else{
		document.getElementById('${pc.id}').innerHTML = '${pc.nomeArquivo}';
	}
#{/list}
});
</script> 